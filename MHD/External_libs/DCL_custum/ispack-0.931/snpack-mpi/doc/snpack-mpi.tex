%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright (C) 2002 Keiichi Ishioka				       %
% 								       %
% この著作権表示が記載してあるならば, どのような媒体にでも何も手を加え %
% ずに複写して再配付することを許可します. これらのドキュメントとその使 % 
% 用許諾を他の言語に翻訳する際は, 以下の条件に従って下さい.	       %
% 								       %
% 他の言語に翻訳する際に, 他の言語での口語表現への変更の範囲を越えて故 %
% 意に意味を変更しないこと.					       %
%								       %
% 翻訳した使用許諾には, それが翻訳であること, また原文の使用許諾が翻訳 %
% 全体に依然適用されることを明示すること.			       %
%								       %
% ハイパーテキストの場合, 同一サイト上で原文のコピーを保守すること. ま %
% た, 翻訳したハイパーテキストのページからその原文へのリンクを提供する %
% こと.								       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%履歴 2002/05/21 石岡圭一 (version 0.0)
%
\documentclass[a4j,fleqn]{jarticle}

\usepackage{amsmath,amssymb}

\title{SNPACK-MPI使用の手引 (version 0.0)}
\author{石岡 圭一  (2002/05/21)}
\date{}

\begin{document}

\maketitle

\section{概要}

これは, スペクトル(球面調和関数)変換を行なうサブルーチンパッケージ
SNPACKをMPIで安直並列化したものである.
従って, 基本的な変換の定義等については
SNPACK使用の手引を参照すること.

本サブルーチンパッケージは内部でMPIのサブルーチンをCALLしているので,
本サブルーチンパッケージに属するサブルーチンをCALLする場合は
{\tt MPI\_INIT}と{\tt MPI\_FINALIZE}で囲まれた枠組の中である必要がある.
また, もちろんヘッダファイル(mpif.h)の読み込みもされている必要
がある. これらMPIの一般的な使用法に関しては当該システムにおける
MPIのマニュアルを参照のこと.

\subsection{計算の並列化について}

SNPACK-MPI(およびこの応用ルーチンであるSPPACK-MPI, SOPACK-MPIも同様だが)
における並列化は非常に安直なものである. すなわち, スペクトルデータは
全プロセスで全く同一のものを重複して保持し, これから逆変換等でグリッドデータ
を生成する際には{\tt JM}の個数の緯度円における変換をできるだけ各プロセスに
均等分割するようにしている. つまり, グリッドデータは各プロセスで分散配置
されることになる. 正変換も同様で, 各プロセスで分散配置されたグリッドデータ
をもとに全プロセスで全く同一のスペクトルデータを求めるようになっている.

このような並列化は計算量・メモリ量・通信量のあらゆる面でデメリットの多い
並列化であるが, 本来のSNPACK, SPPACK, SOPACKに大幅な手直しをする必要なく
実装でき, かつスペクトルデータが分散配置されずに全プロセスで重複保持
されるので, ユーザ側から見てもあまりMPIの詳細に煩わされずにモデル
プログラムを並列化することが可能になるというメリットがある.

また, このような安直並列化でも, 切断波数{\tt MM}の値がプロセス数に
較べて十分大きく, かつプロセス間通信速度が各プロセスでの計算処理速度
に較べて十分速い場合にはまっとうな並列化をした場合に対してそれほど
実効性能は悪くないはずである.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{サブルーチンのリスト}

\vspace{1em}
\begin{tabular}{ll}
{\tt SNMINI} & 初期化\\
{\tt SNTGMS} & グリッドデータからスペクトルデータへの変換
\end{tabular}

%---------------------------------------------------------------------

\subsection{SNMINI}

\begin{enumerate}

\item 機能

SNINITを並列化対応にしたもの.
SNINITとの違いは, 出力にそのプロセスが保持する南北格子点数 {\tt JC}
があることと, 出力{\tt Y}および{\tt P}が各プロセスが保持する南北格子点
に対応して異なっていることである.

\item 呼び出し方法 
    
{\tt SNMINI(MM,IM,JM,JC,IT,T,Y,IP,P,R,IA,A)}
  
\item パラメーターの説明({\tt SNINIT}と異なるもののみ)
    
\begin{tabular}{lll}
{\tt JC} & {\tt (I)} & 出力. そのプロセスで保持する南北格子点数\\
{\tt Y}  & {\tt (D(JM*2))} & 出力. {\tt SNT???}で用いられる配列\\
{\tt P}  & {\tt (D(((MM+1)/2+MM+1)*JM))} & 出力. {\tt SNT???}で用いられる配列\\
\end{tabular}

\item 備考

\begin{itemize}

\item {\tt Y}, {\tt P}の大きさは{\tt JM}に依存するように書いてあるが,
この{\tt JM}は実は{\tt JC}でよい. {\tt JC}の最大値はプロセス数を
{\tt NP}とすれば{\tt (JM-1)/NP+1} (整数の範囲の演算)であるので,
実行プロセス数が事前決まっていてかつメモリを節約したい場合には
この値を使って配列を切っておけばよい.

\end{itemize}

\end{enumerate}

%---------------------------------------------------------------------

\subsection{SNTGMS}

\begin{enumerate}

\item 機能

SNTG2Sを並列化したもの.

\item 定義

スペクトル正変換(概要を参照)により分散配置された格子点上のグリッドデータ
からスペクトルデータを(すべてのプロセスに)求める.

\item 呼び出し方法 

{\tt SNTGMS(MM,IM,ID,JC,JD,KM,G,S,IT,T,Y,IPK,PK,RK,IA,A,Q,WS,WW,IPOW,IFLAG,W)}
  
\item パラメーターの説明({\tt SNTG2S}と異なるもののみ)

\begin{tabular}{lll}
{\tt JC} & {\tt (I)} & 入力. そのプロセスで保持する南北格子点数
                        ({\tt SNMINI}で与えられたもの)\\
{\tt G} & {\tt (D(ID,JD,KM))} & 入力. 分散配置されたグリッドデータ
	が格納されている配列\\
{\tt W}  & {\tt (D((MM+1)*(MM+1)*KM)} & 作業領域
\end{tabular}

\item 備考

\begin{itemize}
\item {\tt JD}$\ge${\tt JC}でなければならない.
   またベクトル計算機においてはバンク競合を避けるために, {\tt JD}
   はできれば奇数にとるのがよい.
   
\item 対応する逆変換ルーチンはあえて書いていないが, これは
 {\tt SNTS2G}で {\tt JM}のところを {\tt JC}と書換えたものがそのまま
 使えるからである.

\end{itemize}

\end{enumerate}

\end{document}
