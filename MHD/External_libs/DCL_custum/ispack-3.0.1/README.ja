**********************************************************************
*     ISPACK3利用の手引き(ver. 3.0.1)   By 石岡圭一 (2019/12/29)
**********************************************************************
-----------------------------------------------------------------------
概要
-----------------------------------------------------------------------

  このライブラリ(ISPACK)は, 主に簡単な流体方程式の数値計算に必要となる
基本的な道具(スペクトル変換等)をサブルーチン群としてまとめたものである. 
各サブルーチンともできるだけ単独で使えることを目標として設計されている
ため, お気楽な統合環境では無いことに注意されたい. すなわち, これらのサ
ブルーチン群をどのように組み合わせて使うかはすべてユーザ次第である.

-----------------------------------------------------------------------
著作権および使用許諾
-----------------------------------------------------------------------

  本ライブラリの著作権は石岡圭一に属する. また, 使用許諾については
COPYRIGHTファイルに書いてあるように, GNU LESSER GENERAL PUBLIC LICENSE
(LGPL-2.1 またはそれ以降のバージョン)に従う. なお, 本ライブラリを用いて
行った数値実験の結果等を論文に発表する際には, 本ライブラリを用いたこと
を記してくれるとありがたい(これはあくまで希望であって, いわゆる宣伝条項
ではない).

-----------------------------------------------------------------------
過去のバージョン(2.1.3 およびそれ以前)との関係
-----------------------------------------------------------------------

  ISPACKのバージョン 3 (およびそれ以降)は, ISPACK バージョン 2.1.3
(およびそれ以前)とは全く独立したライブラリになっており, 相互依存および
名前の衝突は無い.

-----------------------------------------------------------------------
構成
-----------------------------------------------------------------------

本パッケージは以下のようなディレクトリ構成になっている.

  - README: 本ファイル
  - CHANGELOG: 変更履歴
  - COPYRIGHT: 著作権を記述したファイル(英文)
  - LGPL: GNU LESSER GENERAL PUBLIC LICENSE (LGPL)
  - Makefile: Makefileの本体
  - Mkinclude: Makefileにおいて読み込まれるインクルードファイル
		(デフォルトでは, 通常の Linux環境に合わせてある).
  - Mkinclude.sub: 各サブディレクトリ内のMakefileにおいて読み込まれる
		   インクルードファイル
  - fxpack: 高速Fourier変換を行うルーチン群
  - lxpack: ルジャンドル陪関数変換を行うルーチン群
  - sxpack: 球面調和関数変換を行うルーチン群
  - sypack: sxpackを MPI並列化したもの  
  - mxpack: 時刻計測などの雑多なルーチンをまとめたもの

なお, 各**packのディレクトリ以下には, 次のような2つのディレクトリがあ
るので, 必要に応じて参照されたい.

    src: 各サブルーチン群のソースを収めたディレクトリ
    doc: 各サブルーチン群のドキュメント(LaTeX形式)を収めたディレクトリ

-----------------------------------------------------------------------
ライブラリのインストール方法
-----------------------------------------------------------------------

  1) Mkincludeファイル内のマクロ定義を自分の環境に合わせて変更

      それぞれのマクロの意味は自明だとは思うが, 変更が必要となりうる項
    目についてだけ解説する.

    - DIRS: ライブラリ化したいパッケージを列挙する. デフォルトでは全パッ
         ケージになっているが, もし全パッケージが必要ない場合には, 必
         要なパッケージのみを書くこと.

    - LIBNAME: 静的ライブラリの名前. 重複するおそれがなければ,
	デフォルトの libispack3 のままでよい.

    - DESTDIR: 静的ライブラリの置き場所のディレクトリ.

    - FC,FFLAGS: Fortran90コンパイラ名および, 最適化のオプションなどの
	フラグ. なお, ISPACKは内部で 4倍精度浮動小数点数を用いている部
        分があるので, Fortran90コンパイラはそれをサポートしたものでなけ
        ればならない. 従って, 現状では PGI Fortran は使えない.

    - MPIFC,MPIFFLAGS: Fortran90で書かれたMPIプログラムをコンパイル
        するためのコンパイラ名および, それに対応する最適化のオプション
	などのフラグ.

    - CC,CFLAGS: Cコンパイラ名およびそのためのフラグ. 
	
    - SSE: 同梱されている lxpack および sxpack を make する際に与えるスィッチ.
       環境に合わせて以下のいずれかを指定する.
      * AVX命令を持つ Intel x86 互換CPU(Sandy Bridge以降)上の 64bit Linux
        環境:
	     → avx
      * FMA命令を持つ Intel x86 互換CPU(Haswell以降)上の 64bit Linux 環境:
	     → fma
      * AVX512命令を持つ Intel x86 互換CPU(Xeon Phi KL以降)上の 64bit Linux
        環境:
	     → avx512
      * 上記以外
	     → fort

  2) この README のあるディレクトリにおいて, 以下を実行.

	% make

      以上で DESTDIR で指定したディレクトリ以下にライブラリ libispack3.a
      が作成されるはずである.

  3) ライブラリ作成後, 不要となったオブジェクトファイルを掃除したい場
     合は,

	% make clean

      とすればよい. また,

	% make veryclean

      とするとライブラリおよびパッケージファイルも消去され, make 前の状
    態に戻る. SSE のオプション等を間違えた場合は, これによって最初から
    インストールをやりなおすこと.

-----------------------------------------------------------------------
ライブラリの使い方
-----------------------------------------------------------------------

  上で生成されたライブラリ(libispack3.a)は, 通常の Fortran90のライブラリ
であるので, 適宜メインプログラムのコンパイル時にリンクしていただければ
使用可能である. 具体的な使用例は sample ディレクトリ以下を参考にされたい.

-----------------------------------------------------------------------
サンプル集について
-----------------------------------------------------------------------

  本ライブラリを用いて構成された簡単な流体実験等のためのサンプルプログ
ラムを sample ディレクトリ以下にそれぞれディレクトリに分けて置いてある.
現在のところ, 以下のようなものがある.

 - sxpack-test: sxpack のテストプログラム
 - sypack-test: sypack のテストプログラム 

それぞれの利用方法については, 各ディレクトリ以下にあるMEMOファイルを参
照されたい.

-----------------------------------------------------------------------
並列化について
-----------------------------------------------------------------------

  MPIで並列化されたパッケージ(sypack)を使用する場合には, コンパイラや
実行コマンドなどについて各処理系におけるMPIのマニュアルを参照のこと.
なお, 並列化されたパッケージのライブラリの具体的な呼出し方などについて
は, サンプルプログラム(sypack-test)を参考にされたい.

  OpenMPで並列化されたパッケージ(lxpack および sxpack)を使用する場合には,
コンパイラオプションの設定や実行時の環境変数の設定などについて各処理系
におけるマニュアルを参照のこと.

-----------------------------------------------------------------------
論文
-----------------------------------------------------------------------

  本ライブラリ中の球面調和関数変換の高速化についての手法の詳細は,
Ishioka, K. (2018): A New Recurrence Formula for Efficient Computation
of Spherical Harmonic Transform, Journal of the Meteorological Society
of Japan, 96(2), 241-249 に書かれているので, そちらを参照されたい.

https://www.jstage.jst.go.jp/article/jmsj/96/2/96_2018-019/_pdf

-----------------------------------------------------------------------
その他
-----------------------------------------------------------------------

  このパッケージに対するバグレポートや意見は E-mail で

     ishioka@gfd-dennou.org

までお寄せいただきたい.
